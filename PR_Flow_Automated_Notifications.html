<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Notifications</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default', flowchart: { useMaxWidth: true, htmlLabels: true, curve: 'basis' }});
    </script>
    <style>
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5;}
        .container {max-width: 1400px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
        h1 {color: #1976d2; text-align: center; margin-bottom: 10px;}
        .subtitle {text-align: center; color: #666; margin-bottom: 30px; font-style: italic;}
        .navigation {background-color: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 20px; text-align: center;}
        .navigation a {color: #1976d2; text-decoration: none; margin: 0 15px; font-weight: bold;}
        .navigation a:hover {text-decoration: underline;}
        .mermaid-container {background-color: white; padding: 20px; border-radius: 5px; overflow-x: auto;}
        .info-box {background-color: #fff3e0; padding: 15px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #f57c00;}
        .info-box h3 {margin-top: 0; color: #e65100;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Automated Notification System</h1>
        <p class="subtitle">Daily Reminders and Automatic Alerts</p>
        
        <div class="navigation">
            <a href="PR_Flow_Master_Overview.html">Master Overview</a>
            <a href="PR_Flow_6_Fulfillment.html">Stage 6 (Fulfillment)</a>
        </div>

        <div class="mermaid-container">
            <pre class="mermaid">
flowchart TB
    DailyScheduler[System Scheduler<br/>Runs Daily at 8:00 AM]
    
    DailyScheduler --> CheckPendingActions{Check for PRs/POs<br/>with pending actions}
    
    %% Check for PRs needing Procurement action
    CheckPendingActions --> CheckProcPending{PRs pending<br/>Procurement action?}
    CheckProcPending -->|Yes| CheckProcAge{Open for<br/>more than 2<br/>business days?}
    CheckProcAge -->|Yes - Over 2 days| MarkProcUrgent[Mark as Urgent<br/>for twice-daily reminder]
    CheckProcAge -->|No - Under 2 days| SendProcReminder[Send Daily Reminder<br/>to Procurement<br/>8:00 AM only]
    MarkProcUrgent --> SendProcReminderAM[Send Morning Reminder<br/>to Procurement<br/>8:00 AM]
    
    SendProcReminder --> ContinueChecks1[Continue checks]
    SendProcReminderAM --> ContinueChecks1
    CheckProcPending -->|No| ContinueChecks1
    
    %% Check for PRs needing Approver action
    ContinueChecks1 --> CheckApproverPending{PRs pending<br/>Approver action?}
    CheckApproverPending -->|Yes| CheckApproverAge{Open for<br/>more than 2<br/>business days?}
    CheckApproverAge -->|Yes - Over 2 days| MarkApproverUrgent[Mark as Urgent<br/>for twice-daily reminder]
    CheckApproverAge -->|No - Under 2 days| SendApproverReminder[Send Daily Reminder<br/>to Approver<br/>CC: Procurement<br/>8:00 AM only]
    MarkApproverUrgent --> SendApproverReminderAM[Send Morning Reminder<br/>to Approver<br/>CC: Procurement<br/>8:00 AM]
    
    SendApproverReminder --> EndMorning[Morning Notifications<br/>Complete]
    SendApproverReminderAM --> EndMorning
    CheckApproverPending -->|No| EndMorning
    
    %% Afternoon Scheduler (3:00 PM) - Only for Urgent
    AfternoonScheduler[System Scheduler<br/>Runs Daily at 3:00 PM]
    
    AfternoonScheduler --> CheckUrgentOnly{Check PRs/POs marked<br/>as Urgent<br/>Open over 2 business days}
    
    CheckUrgentOnly -->|Procurement Urgent| SendProcReminderPM[Send Afternoon Reminder<br/>to Procurement<br/>3:00 PM]
    CheckUrgentOnly -->|Approver Urgent| SendApproverReminderPM[Send Afternoon Reminder<br/>to Approver<br/>CC: Procurement<br/>3:00 PM]
    CheckUrgentOnly -->|None Urgent| NoAfternoonReminders[No afternoon reminders<br/>needed]
    
    SendProcReminderPM --> EndAfternoon[Afternoon Notifications<br/>Complete]
    SendApproverReminderPM --> EndAfternoon
    NoAfternoonReminders --> EndAfternoon
    
    %% Styling
    classDef schedulerNode fill:#e1bee7,stroke:#8e24aa,stroke-width:3px
    classDef decisionNode fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    classDef urgentNode fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    classDef normalNode fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef endNode fill:#bbdefb,stroke:#1565c0,stroke-width:2px
    
    class DailyScheduler,AfternoonScheduler schedulerNode
    class CheckPendingActions,CheckProcPending,CheckApproverPending,CheckProcAge,CheckApproverAge,CheckUrgentOnly decisionNode
    class MarkProcUrgent,MarkApproverUrgent,SendProcReminderAM,SendApproverReminderAM,SendProcReminderPM,SendApproverReminderPM urgentNode
    class SendProcReminder,SendApproverReminder,ContinueChecks1,NoAfternoonReminders normalNode
    class EndMorning,EndAfternoon endNode
            </pre>
        </div>

        <div class="info-box" style="background-color: #e1f5fe; border-left-color: #0277bd;">
            <h3>Daily Reminder System Overview</h3>
            <p><strong>Two automated reminder schedules:</strong></p>
            
            <h4>1. Morning Reminders (8:00 AM Daily)</h4>
            <ul>
                <li>System checks all PRs/POs with pending actions</li>
                <li>Sends reminders to:
                    <ul>
                        <li><strong>Procurement:</strong> For PRs in SUBMITTED or IN_QUEUE awaiting procurement action</li>
                        <li><strong>Approvers:</strong> For PRs in PENDING_APPROVAL awaiting approval decision</li>
                    </ul>
                </li>
                <li><strong>Frequency:</strong> Once daily at 8:00 AM</li>
                <li><strong>CC:</strong> Procurement always copied on approver reminders</li>
            </ul>
            
            <h4>2. Afternoon Reminders (3:00 PM Daily) - Urgent Only</h4>
            <ul>
                <li>System checks for PRs/POs pending action for <strong>MORE than 2 business days</strong></li>
                <li>Sends second reminder to:
                    <ul>
                        <li><strong>Procurement:</strong> For overdue PRs awaiting procurement action</li>
                        <li><strong>Approvers:</strong> For overdue PRs awaiting approval</li>
                    </ul>
                </li>
                <li><strong>Frequency:</strong> Twice daily (8:00 AM and 3:00 PM) for urgent items only</li>
                <li><strong>Escalation:</strong> Afternoon reminder highlights urgency and elapsed time</li>
            </ul>
        </div>

        <div class="info-box" style="background-color: #fff3e0; border-left-color: #f57c00;">
            <h3>Reminder Notification Content</h3>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <tr style="background-color: #ffe0b2;">
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Type</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Recipient</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Subject</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Content</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>Daily Reminder (Normal)</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Procurement or Approver</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">"Reminder: PRs Pending Your Action"</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">List of PRs, days open, action needed</td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>Urgent Reminder (Over 2 days)</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Procurement or Approver</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">"URGENT: PRs Overdue - Action Required"</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">List of PRs, days open (highlighted), action needed, escalation notice</td>
                </tr>
            </table>
        </div>

        <div class="info-box" style="background-color: #e8f5e9; border-left-color: #388e3c;">
            <h3>What Triggers "Pending Action"?</h3>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <tr style="background-color: #c8e6c9;">
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Status</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Who Gets Reminder</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Action Needed</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">SUBMITTED</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Procurement</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Review, edit, move to queue, reject, or request revision</td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                    <td style="padding: 10px; border: 1px solid #ddd;">IN_QUEUE</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Procurement</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Validate quotes, select approver, push to approver</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">PENDING_APPROVAL</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Assigned Approver(s)</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Review PR, approve, reject, or request revision</td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                    <td style="padding: 10px; border: 1px solid #ddd;">REVISION_REQUIRED</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Requestor</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Edit PR and resubmit or cancel</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">APPROVED</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Procurement & Finance/Admin</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Upload documents (proforma, PoP), move to ORDERED</td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                    <td style="padding: 10px; border: 1px solid #ddd;">ORDERED</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Procurement & Asset Management</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Upload delivery docs (note/photos), move to COMPLETED</td>
                </tr>
            </table>
        </div>

        <div class="info-box" style="background-color: #ffebee; border-left-color: #c62828;">
            <h3>Escalation Rules: 2 Business Days</h3>
            <p><strong>When a PR/PO has been pending action for MORE than 2 business days:</strong></p>
            <ul>
                <li><strong>Reminder Frequency Doubles:</strong> From once daily (8 AM) to twice daily (8 AM and 3 PM)</li>
                <li><strong>Subject Line Changes:</strong> Includes "URGENT" prefix</li>
                <li><strong>Content Enhanced:</strong> Highlights elapsed time and urgency</li>
                <li><strong>Purpose:</strong> Ensures timely processing and prevents PRs from stalling</li>
                <li><strong>Calculation:</strong> Business days only (excludes weekends and holidays)</li>
            </ul>
            
            <p><strong>Example Timeline:</strong></p>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <tr style="background-color: #ffcdd2;">
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Day</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Reminder Schedule</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Urgency</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Day 0 (PR submitted)</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Initial notification</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Normal</td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                    <td style="padding: 10px; border: 1px solid #ddd;">Day 1</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">8:00 AM reminder</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Normal</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Day 2</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">8:00 AM reminder</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Normal</td>
                </tr>
                <tr style="background-color: #fff3e0;">
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>Day 3 (Over 2 days)</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>8:00 AM and 3:00 PM</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>URGENT</strong></td>
                </tr>
                <tr style="background-color: #fff3e0;">
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>Day 4+</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>8:00 AM and 3:00 PM</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>URGENT</strong></td>
                </tr>
            </table>
        </div>

        <div class="info-box" style="background-color: #e3f2fd; border-left-color: #1976d2;">
            <h3>Other Automated Notifications</h3>
            
            <h4>Delivery Delay Notification (From Stage 6)</h4>
            <ul>
                <li><strong>Trigger:</strong> PO in ORDERED status for 3 business days AFTER Estimated Delivery Date (ETD)</li>
                <li><strong>Recipients:</strong> Requestor, Org Admin, Approvers (CC: Procurement)</li>
                <li><strong>Content:</strong> Delivery delay alert with ETD, days overdue, vendor details</li>
                <li><strong>Frequency:</strong> Sent once when threshold reached</li>
            </ul>
            
            <h4>Future Automated Notifications (Potential)</h4>
            <ul>
                <li>Approaching required dates for PRs</li>
                <li>Budget threshold warnings</li>
                <li>Vendor performance alerts</li>
                <li>Monthly/quarterly summary reports</li>
            </ul>
        </div>

        <div class="info-box" style="background-color: #fff9c4; border-left-color: #f9a825;">
            <h3>Business Day Calculation</h3>
            <ul>
                <li><strong>Business Days:</strong> Monday through Friday only</li>
                <li><strong>Excludes:</strong> Weekends (Saturday, Sunday)</li>
                <li><strong>Excludes:</strong> Public holidays (system should have holiday calendar)</li>
                <li><strong>Example:</strong> PR submitted Friday → Day 1 is Monday → Day 2 is Tuesday → Day 3 (urgent) is Wednesday</li>
                <li><strong>Time Calculation:</strong> Based on when PR entered the pending status</li>
            </ul>
        </div>

        <div class="navigation" style="margin-top: 30px;">
            <a href="PR_Flow_Master_Overview.html">← Back to Master Overview</a>
            <a href="PR_Flow_6_Fulfillment.html">Stage 6 (Fulfillment)</a>
        </div>
    </div>
</body>
</html>



